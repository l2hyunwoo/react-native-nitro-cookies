<!-- Parent: ../AGENTS.md -->
<!-- Generated: 2026-02-13 | Updated: 2026-02-13 -->

# android

## Purpose
Android native implementation of the NitroCookies HybridObject in Kotlin, plus JNI/C++ adapter for Nitro Modules initialization. Uses Android's `CookieManager` (WebView-based) for all cookie operations. Includes Gradle build configuration and CMake native build.

## Key Files

| File | Description |
|------|-------------|
| `build.gradle` | Android Gradle build config (Kotlin, CMake, dependencies) |
| `CMakeLists.txt` | CMake config for building the C++ JNI adapter |

## Subdirectories

| Directory | Purpose |
|-----------|---------|
| `src/main/java/com/margelo/nitro/nitrocookies/` | Kotlin source files |
| `src/main/cpp/` | C++ JNI adapter for Nitro module loading |
| `.gradle/` | Gradle cache (gitignored, auto-generated) |
| `.cxx/` | CMake build output (gitignored, auto-generated) |

## For AI Agents

### Working In This Directory
- `NitroCookies.kt` is the main implementation file -- extends `HybridNitroCookiesSpec()` generated by Nitrogen
- `NitroCookiesPackage.kt` is the React Native package registration (loads `libnitrocookies` native library)
- `cpp-adapter.cpp` is the JNI entry point that calls `margelo::nitro::nitrocookies::initialize(vm)`
- Android uses `android.webkit.CookieManager` for all cookie operations (single storage backend, no WebKit/non-WebKit distinction)
- `useWebKit` parameter is accepted but ignored on Android (API compatibility with iOS)
- Cookie deletion works by setting an expired cookie (Android `CookieManager` limitation)
- `getAll()` throws `PLATFORM_UNSUPPORTED` on Android (iOS-only feature)
- Date formatting: converts between ISO 8601 and RFC 1123 for cookie headers
- Some async operations (`clearAll`, `removeSessionCookies`) require `Dispatchers.Main` because `CookieManager` callbacks run on the main thread

### Testing Requirements
- No unit tests in this directory -- test via the `example/` Android app
- Test on various Android API levels (min API 21+)
- Verify cookie persistence across app restarts (test `flush()`)

### Common Patterns
- `Promise.async { ... }` for async operations
- `suspendCancellableCoroutine` to bridge callback-based `CookieManager` APIs to coroutines
- `toRFC6265String()` serializes Cookie struct to Set-Cookie header format
- `createCookieData()` parses Set-Cookie header string back to Cookie struct
- `validateURL()` / `validateDomain()` for input validation

## Dependencies

### Internal
- `nitrogen/generated/android/` -- `HybridNitroCookiesSpec`, `Cookie` data class, JNI bridges
- `nitrogen/generated/shared/c++/` -- C++ spec and Cookie struct

### External
- `android.webkit.CookieManager` -- Cookie storage (WebView-based)
- `java.net.HttpURLConnection` -- HTTP requests for `getFromResponse()`
- `com.margelo.nitro.core.Promise` -- Nitro async return type
- `kotlinx.coroutines` -- Coroutine support for async callbacks

<!-- MANUAL: Any manually added notes below this line are preserved on regeneration -->
